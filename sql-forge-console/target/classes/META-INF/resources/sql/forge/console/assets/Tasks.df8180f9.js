import{dy as z,a as D,q as Y,t as k,d as T,y as H,R as l,S as I,o as G,e as J,f as Q,n as X}from"./index.e87dba99.js";var P={exports:{}};(function(A,u){Object.defineProperty(u,"__esModule",{value:!0});function r(t){return typeof t=="object"&&!("toString"in t)?Object.prototype.toString.call(t).slice(8,-1):t}var a=typeof process=="object"&&!0;function s(t,e){if(!t)throw a?new Error("Invariant failed"):new Error(e())}u.invariant=s;var p=Object.prototype.hasOwnProperty,y=Array.prototype.splice,$=Object.prototype.toString;function m(t){return $.call(t).slice(8,-1)}var v=Object.assign||function(t,e){return S(e).forEach(function(i){p.call(e,i)&&(t[i]=e[i])}),t},S=typeof Object.getOwnPropertySymbols=="function"?function(t){return Object.keys(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.keys(t)};function d(t){return Array.isArray(t)?v(t.constructor(t.length),t):m(t)==="Map"?new Map(t):m(t)==="Set"?new Set(t):t&&typeof t=="object"?v(Object.create(Object.getPrototypeOf(t)),t):t}var C=function(){function t(){this.commands=v({},E),this.update=this.update.bind(this),this.update.extend=this.extend=this.extend.bind(this),this.update.isEquals=function(e,i){return e===i},this.update.newContext=function(){return new t().update}}return Object.defineProperty(t.prototype,"isEquals",{get:function(){return this.update.isEquals},set:function(e){this.update.isEquals=e},enumerable:!0,configurable:!0}),t.prototype.extend=function(e,i){this.commands[e]=i},t.prototype.update=function(e,i){var n=this,o=typeof i=="function"?{$apply:i}:i;Array.isArray(e)&&Array.isArray(o)||s(!Array.isArray(o),function(){return"update(): You provided an invalid spec to update(). The spec may not contain an array except as the value of $set, $push, $unshift, $splice or any custom command allowing an array value."}),s(typeof o=="object"&&o!==null,function(){return"update(): You provided an invalid spec to update(). The spec and every included key path must be plain objects containing one of the "+("following commands: "+Object.keys(n.commands).join(", ")+".")});var c=e;return S(o).forEach(function(h){if(p.call(n.commands,h)){var U=e===c;c=n.commands[h](o[h],c,o,e),U&&n.isEquals(c,e)&&(c=e)}else{var L=m(e)==="Map"?n.update(e.get(h),o[h]):n.update(e[h],o[h]),W=m(c)==="Map"?c.get(h):c[h];(!n.isEquals(L,W)||typeof L=="undefined"&&!p.call(e,h))&&(c===e&&(c=d(e)),m(c)==="Map"?c.set(h,L):c[h]=L)}}),c},t}();u.Context=C;var E={$push:function(t,e,i){return b(e,i,"$push"),t.length?e.concat(t):e},$unshift:function(t,e,i){return b(e,i,"$unshift"),t.length?t.concat(e):e},$splice:function(t,e,i,n){return _(e,i),t.forEach(function(o){N(o),e===n&&o.length&&(e=d(n)),y.apply(e,o)}),e},$set:function(t,e,i){return B(i),t},$toggle:function(t,e){g(t,"$toggle");var i=t.length?d(e):e;return t.forEach(function(n){i[n]=!e[n]}),i},$unset:function(t,e,i,n){return g(t,"$unset"),t.forEach(function(o){Object.hasOwnProperty.call(e,o)&&(e===n&&(e=d(n)),delete e[o])}),e},$add:function(t,e,i,n){return w(e,"$add"),g(t,"$add"),m(e)==="Map"?t.forEach(function(o){var c=o[0],h=o[1];e===n&&e.get(c)!==h&&(e=d(n)),e.set(c,h)}):t.forEach(function(o){e===n&&!e.has(o)&&(e=d(n)),e.add(o)}),e},$remove:function(t,e,i,n){return w(e,"$remove"),g(t,"$remove"),t.forEach(function(o){e===n&&e.has(o)&&(e=d(n)),e.delete(o)}),e},$merge:function(t,e,i,n){return q(e,t),S(t).forEach(function(o){t[o]!==e[o]&&(e===n&&(e=d(n)),e[o]=t[o])}),e},$apply:function(t,e){return M(t),t(e)}},f=new C;u.isEquals=f.update.isEquals,u.extend=f.extend,u.default=f.update,u.default.default=A.exports=v(u.default,u);function b(t,e,i){s(Array.isArray(t),function(){return"update(): expected target of "+r(i)+" to be an array; got "+r(t)+"."}),g(e[i],i)}function g(t,e){s(Array.isArray(t),function(){return"update(): expected spec of "+r(e)+" to be an array; got "+r(t)+". Did you forget to wrap your parameter in an array?"})}function _(t,e){s(Array.isArray(t),function(){return"Expected $splice target to be an array; got "+r(t)}),N(e.$splice)}function N(t){s(Array.isArray(t),function(){return"update(): expected spec of $splice to be an array of arrays; got "+r(t)+". Did you forget to wrap your parameters in an array?"})}function M(t){s(typeof t=="function",function(){return"update(): expected spec of $apply to be a function; got "+r(t)+"."})}function B(t){s(Object.keys(t).length===1,function(){return"Cannot have more than one key in an object with $set"})}function q(t,e){s(e&&typeof e=="object",function(){return"update(): $merge expects a spec of type 'object'; got "+r(e)}),s(t&&typeof t=="object",function(){return"update(): $merge expects a target of type 'object'; got "+r(t)})}function w(t,e){var i=m(t);s(i==="Map"||i==="Set",function(){return"update(): "+r(e)+" expects a target of type Set or Map; got "+r(i)})}})(P,P.exports);var R=z(P.exports),Z=function(A){D(u,A);function u(r){var a=A.call(this,r)||this;return a.state={items:r.items?r.items.concat():[]},a.handleLoaded=a.handleLoaded.bind(a),a.tick=a.tick.bind(a),a}return u.prototype.componentDidMount=function(){this.tick(!!this.props.checkApi)},u.prototype.componentDidUpdate=function(r){var a=this.props;r.items!==a.items?this.setState({items:a.items?a.items.concat():[]}):Y(r.checkApi,a.checkApi,r.data,a.data)&&this.tick(!0)},u.prototype.componentWillUnmount=function(){clearTimeout(this.timer)},u.prototype.reload=function(){this.tick(!0)},u.prototype.tick=function(r){var a=this;r===void 0&&(r=!1);var s=this.props,p=s.loadingStatusCode,y=s.data,$=s.interval,m=s.checkApi,v=s.env,S=this.state.items;if(clearTimeout(this.timer),!(!r&&!S.some(function(d){return d.status===p}))){if($&&!k(m))return v.alert("checkApi \u6CA1\u6709\u8BBE\u7F6E, \u4E0D\u80FD\u53CA\u65F6\u83B7\u53D6\u4EFB\u52A1\u72B6\u6001");k(m,y)&&v&&v.fetcher(m,y).then(this.handleLoaded).catch(function(d){return a.setState({error:d})})}},u.prototype.handleLoaded=function(r){if(!Array.isArray(r.data))return this.props.env.alert("\u8FD4\u56DE\u683C\u5F0F\u4E0D\u6B63\u786E, \u671F\u671B response.data \u4E3A\u6570\u7EC4, \u5305\u542B\u6BCF\u4E2A task \u7684\u72B6\u6001\u4FE1\u606F");this.setState({items:r.data});var a=this.props.interval;clearTimeout(this.timer),this.timer=setTimeout(this.tick,a)},u.prototype.submitTask=function(r,a,s){var p=this;s===void 0&&(s=!1);var y=this.props,$=y.submitApi,m=y.reSubmitApi,v=y.loadingStatusCode,S=y.errorStatusCode,d=y.data,C=y.env;if(!s&&!k($))return C.alert("submitApi \u6CA1\u6709\u914D\u7F6E");if(s&&!k(m))return C.alert("reSubmitApi \u6CA1\u6709\u914D\u7F6E");this.setState(R(this.state,{items:{$splice:[[a,1,T(T({},r),{status:v})]]}}));var E=s?m:$;k(E,d)&&C&&C.fetcher(E,H(d,r)).then(function(f){if(f&&f.data){if(Array.isArray(f.data))p.handleLoaded(f);else{E&&E.replaceData;var b=p.state.items.map(function(g){return g.key===f.data.key?T(T({},E.replaceData?{}:g),f.data):g});p.handleLoaded(T(T({},f),{data:b}))}return}clearTimeout(p.timer),p.timer=setTimeout(p.tick,4)}).catch(function(f){return p.setState(R(p.state,{items:{$splice:[[a,1,T(T({},r),{status:S,remark:f.message||f})]]}}))})},u.prototype.render=function(){var r=this,a=this.props,s=a.classnames,p=a.className,y=a.style,$=a.tableClassName,m=a.taskNameLabel,v=a.operationLabel,S=a.statusLabel,d=a.remarkLabel,C=a.btnText,E=a.retryBtnText,f=a.btnClassName,b=a.retryBtnClassName,g=a.statusLabelMap,_=a.statusTextMap,N=a.readyStatusCode,M=a.loadingStatusCode,B=a.canRetryStatusCode,q=a.translate,w=a.render,t=a.loadingConfig,e=this.state.items,i=this.state.error;return l.createElement("div",{className:s("Table-content",p),style:y},l.createElement("table",{className:s("Table-table",$)},l.createElement("thead",null,l.createElement("tr",null,l.createElement("th",null,m),l.createElement("th",null,q(v)),l.createElement("th",null,S),l.createElement("th",null,d))),l.createElement("tbody",null,i?l.createElement("tr",null,l.createElement("td",{colSpan:4},l.createElement("div",{className:"text-danger"},i))):e.map(function(n,o){var c;return l.createElement("tr",{key:o},l.createElement("td",null,l.createElement("span",{className:s("word-break")},n.label)),l.createElement("td",null,n.status==M?l.createElement(I,{loadingConfig:t,show:!0,icon:"reload",spinnerClassName:s("Task-spinner")}):n.status==B?l.createElement("a",{onClick:function(){return r.submitTask(n,o,!0)},className:s("Button","Button--danger","Button--size-md",b||f)},E||C):l.createElement("a",{onClick:function(){return r.submitTask(n,o)},className:s("Button","Button--default","Button--size-md",f,(c={},c["is-disabled"]=n.status!==N,c))},C)),l.createElement("td",null,l.createElement("span",{className:s("label",g&&g[n.status||0])},_&&_[n.status||0])),l.createElement("td",null,n.remark?w("".concat(o,"/remark"),n.remark):null))}))))},u.defaultProps={className:"",tableClassName:"",taskNameLabel:"\u4EFB\u52A1\u540D\u79F0",operationLabel:"Table.operation",statusLabel:"\u72B6\u6001",remarkLabel:"\u5907\u6CE8\u8BF4\u660E",btnText:"\u4E0A\u7EBF",retryBtnText:"\u91CD\u8BD5",btnClassName:"",retryBtnClassName:"",statusLabelMap:["label-warning","label-info","label-info","label-danger","label-success","label-danger"],statusTextMap:["\u672A\u5F00\u59CB","\u5C31\u7EEA","\u8FDB\u884C\u4E2D","\u51FA\u9519","\u5DF2\u5B8C\u6210","\u51FA\u9519"],initialStatusCode:0,readyStatusCode:1,loadingStatusCode:2,errorStatusCode:3,finishStatusCode:4,canRetryStatusCode:5,interval:3e3},u}(l.Component),F=function(A){D(u,A);function u(r,a){var s=A.call(this,r)||this,p=a;return p.registerComponent(s),s}return u.prototype.componentWillUnmount=function(){A.prototype.componentWillUnmount.call(this);var r=this.context;r.unRegisterComponent(this)},u.contextType=G,u=J([Q({type:"tasks"}),X("design:paramtypes",[Object,Object])],u),u}(Z);export{F as TaskRenderer,Z as default};
