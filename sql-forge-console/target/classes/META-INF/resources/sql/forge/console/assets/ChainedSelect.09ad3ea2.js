import{a as B,W as T,t as z,d as C,g as w,h as O,aC as H,al as q,an as J,R as A,b as K,a0 as E,aq as R,J as M,S as L,K as W,e as D,Z,n as P,b2 as $,aE as G,V as U}from"./index.7fe4d422.js";var Q=function(I){B(c,I);function c(t){var e=I.call(this,t)||this;return e.state={stack:[]},e.handleChange=e.handleChange.bind(e),e.loadMore=e.loadMore.bind(e),e}return c.prototype.componentDidMount=function(){var t,e,a=this.props.formInited;a||!this.props.addHook?this.loadMore():(e=(t=this.props).addHook)===null||e===void 0||e.call(t,this.loadMore,"init")},c.prototype.componentDidUpdate=function(t){var e=this.props;t.options!==e.options?this.setState({stack:[]}):e.formInited&&e.value!==t.value&&this.loadMore()},c.prototype.doAction=function(t,e,a){var o,h,u=this.props,f=u.resetValue,d=u.onChange,v=u.formStore,l=u.store,r=u.name,p=t==null?void 0:t.actionType;if(p==="clear")d("");else if(p==="reset"){var i=(h=T((o=v==null?void 0:v.pristine)!==null&&o!==void 0?o:l==null?void 0:l.pristine,r))!==null&&h!==void 0?h:f;d(i!=null?i:"")}},c.prototype.array2value=function(t,e){e===void 0&&(e=!1);var a=this.props,o=a.delimiter,h=a.joinValues,u=a.extractValue,f=a.valueField;return e?h?t.join(o||","):t:h?t.join(o||","):u?t.map(function(d){return d[f||"value"]||d}):t},c.prototype.loadMore=function(){for(var t=this,e=this.props,a=e.value,o=e.delimiter,h=e.onChange,u=e.joinValues,f=e.extractValue,d=e.valueField,v=e.source,l=e.data,r=e.env,p=e.dispatchEvent,i=Array.isArray(a)?a.concat():a&&typeof a=="string"?a.split(o||","):[],n=0,_=this.state.stack.length;n<_&&i[n]&&this.state.stack[n].parentId==(u||f?i[n]:i[n][d||"value"]);)n++;if(!(!i[n]||!r||!z(v,l))){var y=u||f?i[n]:i[n][d||"value"],b=this.state.stack.concat();b.splice(n,b.length-n),b.push({parentId:y,loading:!0,options:[]}),this.setState({stack:b},function(){r.fetcher(v,C(C({},l),{value:i,level:n+1,parentId:y,parent:i[n]})).then(function(s){return w(t,void 0,void 0,function(){var m,N,g,S,k,V,x,j;return O(this,function(F){switch(F.label){case 0:return m=this.state.stack.concat(),N=s.data?s.data[d||"value"]:void 0,g=((V=s==null?void 0:s.data)===null||V===void 0?void 0:V.options)||((x=s==null?void 0:s.data)===null||x===void 0?void 0:x.items)||((j=s==null?void 0:s.data)===null||j===void 0?void 0:j.rows)||s.data||[],m.splice(n,m.length-n),typeof N=="undefined"?[3,2]:(i.splice(n+1,a.length-n-1),i.push(N),S=this.array2value(i,!0),[4,p("change",U(this.props,{value:S}))]);case 1:if(k=F.sent(),k!=null&&k.prevented)return[2];h(S),F.label=2;case 2:return m.push({options:g,parentId:y,loading:!1,visible:Array.isArray(g)&&!G(g)}),this.setState({stack:m},this.loadMore),[2]}})})}).catch(function(s){!(v!=null&&v.silent)&&r.notify("error",s.message)})})}},c.prototype.handleChange=function(t,e){return w(this,void 0,void 0,function(){var a,o,h,u,f,d,v,l,r,p,i;return O(this,function(n){switch(n.label){case 0:return a=this.props,o=a.value,h=a.delimiter,u=a.onChange,f=a.joinValues,a.extractValue,d=a.dispatchEvent,v=a.valueField,a.data,l=Array.isArray(o)?o.concat():o&&typeof o=="string"?o.split(h||","):[],l.splice(t,l.length-t),r=f?e[v||"value"]:e,r!==void 0&&l.push(r),p=this.array2value(l),[4,d("change",U(this.props,{value:p}))];case 1:return i=n.sent(),i!=null&&i.prevented?[2]:(u(p),[2])}})})},c.prototype.reload=function(t,e){var a=this.props.reloadOptions;a&&a(t,e)},c.prototype.renderStatic=function(t){t===void 0&&(t="-");var e=this.props,a=e.options,o=a===void 0?[]:a,h=e.labelField,u=e.valueField,f=e.classPrefix,d=e.classnames,v=e.className,l=e.value,r=e.delimiter,p=H([{options:o,visible:!0}],q(this.state.stack||[]),!1),i=Array.isArray(l)?l.concat():l&&typeof l=="string"?l.split(r||","):[];return(i==null?void 0:i.length)>0&&(t=i.map(function(n,_){var y,b=p[_]||{},s=b.options,m=b.visible;if(m===!1)return null;if(!s||!s.length)return n;var N=J(s,function(g){return n===g[u||"value"]})||{};return(y=N[h||"label"])!==null&&y!==void 0?y:n}).filter(function(n){return n!=null}).join(" > ")),A.createElement("div",{className:d("".concat(f,"SelectStaticControl"),v)},t)},c.prototype.render=function(){var t=this,e=this.props,a=e.options,o=e.classPrefix,h=e.className,u=e.style;e.inline;var f=e.loading,d=e.value,v=e.delimiter;e.joinValues,e.extractValue,e.multiple;var l=e.mobileUI,r=e.env,p=e.testIdBuilder,i=e.popoverClassName,n=e.placeholder,_=K(e,["options","classPrefix","className","style","inline","loading","value","delimiter","joinValues","extractValue","multiple","mobileUI","env","testIdBuilder","popoverClassName","placeholder"]),y=Array.isArray(d)?d.concat():d&&typeof d=="string"?d.split(v||","):[],b=this.props,s=b.themeCss,m=b.id,N=this.state.stack.find(function(g){return g.loading});return A.createElement("div",{className:E("".concat(o,"ChainedSelectControl"),h)},A.createElement(R,C({},_,{placeholder:n,mobileUI:l,popOverContainer:l?r==null?void 0:r.getModalContainer:_.popOverContainer||(r==null?void 0:r.getModalContainer),className:E(M(C(C({},this.props),{name:"chainedSelectControlClassName",id:m,themeCss:s}))),popoverClassName:E(i,M(C(C({},this.props),{name:"chainedSelectPopoverClassName",id:m,themeCss:s}))),controlStyle:u,classPrefix:o,key:"base",testIdBuilder:p==null?void 0:p.getChild("base"),options:Array.isArray(a)?a:[],value:y[0],onChange:this.handleChange.bind(this,0),loading:f,inline:!0})),this.state.stack.map(function(g,S){var k=g.options,V=g.loading,x=g.visible;return x===!1||V?null:A.createElement(R,C({},_,{mobileUI:l,popOverContainer:l?r.getModalContainer:_.popOverContainer||(r==null?void 0:r.getModalContainer),classPrefix:o,key:"x-".concat(S+1),testIdBuilder:p==null?void 0:p.getChild("x-".concat(S+1)),options:Array.isArray(k)?k:[],value:y[S+1],onChange:t.handleChange.bind(t,S+1),inline:!0,controlStyle:u,className:E(M(C(C({},t.props),{name:"chainedSelectControlClassName",id:m,themeCss:s}))),popoverClassName:E(i,M(C(C({},t.props),{name:"chainedSelectPopoverClassName",id:m,themeCss:s})))}))}),N&&A.createElement(L,{size:"sm",className:E("".concat(o,"ChainedSelectControl-spinner"))}),A.createElement(W,C({},this.props,{config:{themeCss:s,classNames:[{key:"chainedSelectControlClassName",weights:{focused:{suf:".is-opened:not(.is-mobile)"},disabled:{suf:".is-disabled"}}},{key:"chainedSelectPopoverClassName",weights:{default:{suf:" .".concat(o,"Select-option")},hover:{suf:" .".concat(o,"Select-option.is-highlight")},focused:{inner:".".concat(o,"Select-option.is-active")}}}],id:m},env:r})))},c.defaultProps={clearable:!1,searchable:!1,multiple:!0},D([Z(),P("design:type",Function),P("design:paramtypes",[]),P("design:returntype",void 0)],c.prototype,"render",null),c}(A.Component),Y=function(I){B(c,I);function c(){return I!==null&&I.apply(this,arguments)||this}return c=D([$({type:"chained-select",sizeMutable:!1})],c),c}(Q);export{Y as ChainedSelectControlRenderer,Q as default};
