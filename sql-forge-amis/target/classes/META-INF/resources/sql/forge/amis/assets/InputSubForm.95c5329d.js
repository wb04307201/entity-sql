import{a as T,aS as k,y,d as s,a8 as w,aJ as z,aj as U,ao as A,R as r,I as S,a0 as j,bc as H,e as L,m as q,n as I,F as J}from"./index.42865952.js";var F,_=function(h){return h&&(F=F||document.createElement("div"),F.innerHTML=h,F.innerText)},W=function(h){T(o,h);function o(a){var e=h.call(this,a)||this;return e.state={},e.id=k(),e.addItem=e.addItem.bind(e),e.removeItem=e.removeItem.bind(e),e.editSingle=e.editSingle.bind(e),e.open=e.open.bind(e),e.close=e.close.bind(e),e.dragTipRef=e.dragTipRef.bind(e),e.handleDialogConfirm=e.handleDialogConfirm.bind(e),e}return o.prototype.addItem=function(){this.setState({dialogData:y(this.props.data,this.props.scaffold||{}),dialogCtx:{mode:"add"}})},o.prototype.removeItem=function(a){a.stopPropagation(),a.preventDefault();var e=parseInt(a.currentTarget.getAttribute("data-index"),10),i=this.props.value;!Array.isArray(i)||(i=i.concat(),i.splice(e,1),this.props.onChange(i))},o.prototype.editSingle=function(){var a=this.props.value;a?this.setState({dialogData:y(this.props.data,this.props.value),dialogCtx:{mode:"edit"}}):this.addItem()},o.prototype.open=function(a){var e=parseInt(a.currentTarget.getAttribute("data-index"),10),i=this.props.value;!Array.isArray(i)||!i[e]||(this.tempValue=i[e],this.setState({dialogData:y(this.props.data,i[e]),dialogCtx:{mode:"edit",index:e}}))},o.prototype.close=function(){this.setState({dialogData:void 0,dialogCtx:void 0})},o.prototype.handleDialogConfirm=function(a){var e=this.props,i=e.multiple,u=e.onChange,l=e.value,t=this.state.dialogCtx;if(i){var n=Array.isArray(l)?l.concat():[];(t==null?void 0:t.mode)==="add"?n.push(s({},a[0])):n[t.index]=s(s({},n[t.index]),a[0]),u(n)}else u(s(s({},l),a[0]));this.close()},o.prototype.handlePopupConfirm=function(){var a=this.tempValue,e=this.props,i=e.multiple,u=e.onChange,l=e.value,t=this.state.dialogCtx;if(i){var n=Array.isArray(l)?l.concat():[];(t==null?void 0:t.mode)==="add"?n.push(s({},a)):n[t.index]=s(s({},n[t.index]),a),u(n)}else u(s(s({},l),a));this.close()},o.prototype.dragTipRef=function(a){!this.dragTip&&a?this.initDragging():this.dragTip&&!a&&this.destroyDragging(),this.dragTip=a},o.prototype.initDragging=function(){var a=this,e=this.props.classPrefix,i=this.props.submitOnChange,u=w.exports.findDOMNode(this);this.sortable=new z(u.querySelector(".".concat(e,"SubForm-values")),{group:"SubForm-".concat(this.id),animation:150,handle:".".concat(e,"SubForm-valueDragBar"),ghostClass:"".concat(e,"SubForm-value--dragging"),onEnd:function(l){if(l.newIndex!==l.oldIndex){var t=l.to;l.oldIndex<t.childNodes.length-1?t.insertBefore(l.item,t.childNodes[l.oldIndex>l.newIndex?l.oldIndex+1:l.oldIndex]):t.appendChild(l.item);var n=a.props.value;if(!!Array.isArray(n)){var m=n.concat();m.splice(l.newIndex,0,m.splice(l.oldIndex,1)[0]),a.props.onChange(m,i,!0)}}}})},o.prototype.destroyDragging=function(){this.sortable&&this.sortable.destroy()},o.prototype.buildDialogSchema=function(){var a=this.props.form,e=["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"];return s(s({},U(a,e)),{type:"dialog",body:s(s({type:"form",canAccessSuperData:!1},A(a,e)),{inheritData:!1})})},o.prototype.buildFormSchema=function(){var a=this.props.form,e=["title","actions","name","size","closeOnEsc","closeOnOutside","showErrorMsg","showCloseButton","bodyClassName","type"];return s(s({type:"form",canAccessSuperData:!1},A(a,e)),{inheritData:!1})},o.prototype.renderMultipe=function(){var a=this,e=this.props,i=e.addButtonClassName,u=e.itemClassName,l=e.itemsClassName,t=e.disabled,n=e.maxLength,m=e.labelField,b=e.defaultLabel,d=e.value,g=e.btnLabel,v=e.render,C=e.data,p=e.translate,c=e.classnames,B=e.placeholder,E=e.draggable,O=e.draggableTip,P=e.addable,M=e.removable,D=e.minLength,R=e.addButtonText,f=e.testIdBuilder;return r.createElement(r.Fragment,null,Array.isArray(d)&&d.length?r.createElement("div",{className:c("SubForm-values",l),key:"values"},d.map(function(x,N){return r.createElement("div",s({className:c("SubForm-value",{"is-disabled":t},u),key:N},f==null?void 0:f.getChild("item-".concat(N)).getTestId()),E&&d.length>1?r.createElement("a",{className:c("SubForm-valueDragBar")},r.createElement(S,{icon:"drag-bar",className:c("icon")})):null,r.createElement("span",{className:c("SubForm-valueLabel")},g&&v("label",{type:"tpl",tpl:p(g)},{data:y(C,x)}),!g&&(x&&m&&x[m]&&_(x[m])||p(b))),r.createElement("a",{"data-index":N,onClick:a.open,className:c("SubForm-valueEdit")},r.createElement(S,{icon:"pencil",className:"icon"})),!t&&M!==!1&&(!D||d.length>D)?r.createElement("a",{"data-index":N,className:c("SubForm-valueDel"),onClick:a.removeItem},r.createElement(S,{icon:"close",className:"icon"})):null)})):r.createElement("div",{className:c("SubForm-placeholder"),key:"placeholder"},p(B||"placeholder.empty")),r.createElement("div",{key:"toolbar",className:c("SubForm-toolbar")},P!==!1?r.createElement("button",s({type:"button",onClick:this.addItem,className:c("Button SubForm-addBtn",i),disabled:t||!!(n&&Array.isArray(d)&&d.length>=n)},f==null?void 0:f.getChild("add-button").getTestId()),r.createElement(S,{icon:"plus",className:"icon"}),r.createElement("span",null,p(R||"SubForm.add"))):null,E&&Array.isArray(d)&&d.length>1?r.createElement("span",{className:c("Combo-dragableTip"),ref:this.dragTipRef},Array.isArray(d)&&d.length>1?p(O):""):null))},o.prototype.renderSingle=function(){var a=this.props,e=a.classnames,i=a.itemsClassName,u=a.itemClassName,l=a.disabled,t=a.value,n=a.labelField,m=a.defaultLabel,b=a.btnLabel,d=a.render,g=a.data,v=a.translate,C=a.testIdBuilder,p=C==null?void 0:C.getChild("edit-single");return r.createElement("div",{className:e("SubForm-values",i),key:"values"},r.createElement("div",s({className:e("SubForm-value",{"is-disabled":l},u),onClick:this.editSingle,"data-tooltip":v("SubForm.editDetail"),"data-position":"bottom"},p==null?void 0:p.getTestId()),r.createElement("span",{className:e("SubForm-valueLabel")},b&&d("label",{type:"tpl",tpl:v(b)},{data:y(g,t)}),!b&&(t&&n&&t[n]&&_(t[n])||v(m))),r.createElement("a",s({className:e("SubForm-valueEdit")},p==null?void 0:p.getChild("icon").getTestId()),r.createElement(S,{icon:"pencil",className:"icon"}))))},o.prototype.render=function(){var a=this,e=this.props,i=e.multiple,u=e.classPrefix,l=e.className;e.style;var t=e.render,n=e.mobileUI,m=e.env,b=e.popOverContainer,d=this.state.dialogData,g=this.state.dialogCtx;return r.createElement("div",{className:j("".concat(u,"SubFormControl"),l)},i?this.renderMultipe():this.renderSingle(),n?r.createElement(H,{isShow:!!g,showConfirm:!0,onConfirm:this.handlePopupConfirm,onHide:this.close,container:n?m==null?void 0:m.getModalContainer:b||m.getModalContainer},r.createElement("div",{className:"flex-1 pl-10 pr-10"},t("form",this.buildFormSchema(),{data:d,formStore:void 0,wrapWithPanel:!1,onChange:function(v){a.tempValue=v}}))):t("modal",this.buildDialogSchema(),{show:!!g,onClose:this.close,onConfirm:this.handleDialogConfirm,data:d,formStore:void 0}))},o.defaultProps={minLength:0,maxLength:0,multiple:!1,btnClassName:"",addButtonClassName:"",itemClassName:"",labelField:"label",defaultLabel:"SubForm.button",placeholder:"placeholder.empty"},o.propsList=["form","formStore"],L([q,I("design:type",Function),I("design:paramtypes",[]),I("design:returntype",void 0)],o.prototype,"handlePopupConfirm",null),o}(r.PureComponent),G=function(h){T(o,h);function o(){return h!==null&&h.apply(this,arguments)||this}return o=L([J({type:"input-sub-form",sizeMutable:!1,strictMode:!1})],o),o}(W);export{G as SubFormControlRenderer,W as default};
